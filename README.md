# EnterTask WebAPI

## Описание

Приложение представляет собой API для управления событиями и участниками. Реализовано с использованием ASP.NET Core и базы данных MS SQL, развёрнутой в Docker. Само приложение реализует многослойную структуру.

## Запуск проекта

### Требования

- .NET 7 SDK
- Docker
- SQL-клиент (например, SQL Server Management Studio)

### Шаг 1: Запуск MS SQL в Docker

```bash
docker run -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=ModsenEnterTask!1' -p 1433:1433 -d --name sqlserver mcr.microsoft.com/mssql/server:2022-latest
```

### Шаг 2: Восстановление базы данных

1. Подключитесь к серверу через SQL Server Management Studio:

```
Server name: localhost  
Authentication: SQL Server Authentication  
Login: sa  
Password: ModsenEnterTask!1  
Trust server certificate: True
```

2. Загрузите файл .bak в контейнер:

```bash
docker cp ./StartUp/ModsenEnterTask.Database.bak sqlserver:/var/opt/mssql/data
```

3. Восстановите базу данных из бэкапа.

> Если используется другое имя контейнера, в строке подключения в `appsettings.json` замените `sqlserver` на нужное имя.

### Шаг 3: Сборка и запуск API

- Соберите и запустите WebAPI.
- Убедитесь, что контейнеры API и базы данных находятся в одной сети.
- Откройте Swagger по адресу: `http://localhost:{порт}/swagger`

## Авторизация

JWT-токен обязателен для доступа к защищённым методам.

### Учетные данные

| Роль  | Логин | Пароль |
|-------|-------|--------|
| Admin | sa    | 1111   |
| User  | user  | 2222   |

1. Получите токен через AuthController.
2. Добавьте токен через кнопку "Authorize" в Swagger UI.

## Контроллеры

- EventsController — управление событиями
- ParticipantsController — управление участниками

## Changelog

### VER 1.0.1
- Репозитории переделаны с учетом замечаний;
- Добавлено абстрактное описание базового класса для последующего наследования;
- Пагинация и фильтрация добавлены в стандартные репозитории;
- Во время выборок данных убрано отслеживание изменений (AsNoTracking()).

### VER 1.1.0
- Определена многослойная структура проекта;
- Добавлен глобальный обработчик событий;
- Определена бизнес логика приложения с вынесенными сервисами;
- Добавлены кастомные исключения;
- Убрана логика контроля исполнения кода с помощью выбрасываемых исключений;
- Изображения в базее данных теперь хранятся в формате бинарного файла;
- Добавлен алгоритм хеширования пароля при добавлении в базу данных;
- Добавлены миграции для базы данных. Формат выполнения переопределен с database-first на codefirst;

## Стартовые данные

Восстановленная база содержит стартовые записи.